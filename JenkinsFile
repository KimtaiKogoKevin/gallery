pipeline {
    agent any 
     environment {

       
        RENDER_SITE = 'https://dashboard.render.com/web/srv-cfojmq82i3mo4btvhb10/events'
    }

    
    tools {
        nodejs 'Node-14'
    }
    
    stages {
        stage ('Clone repository'){
            steps{
                git 'https://github.com/KimtaiKogoKevin/gallery.git'
            }
        }
        
        stage ('Install dependencies'){
            steps{
                sh 'npm install'
            }
        }
        
        stage ('Run tests'){
            steps{
                sh 'npm test'
            }
        }
        stage ('Deploy to Render'){
            steps{
                withCredentials([usernameColonPassword(credentialsId:'42b90fbb-942e-4589-930b-c6e7c853f527',variable:'1051113kkk')]){
                sh 'git push https://api.render.com/deploy/srv-cfojmq82i3mo4btvhb10?key=-tJe9JTO08A'
                }
            }
        }
        
        
    }
    
     post {
        failure{
           emailext body: 'This is build has failed , {env.BUILD_NUMBER}', subject: 'Failed Build', to: 'kevin.kogo@student.moringaschool.com'
        }
        
         always{
            slackSend( channel: "#jenkins", token: "slack_webhook token", color: "good", message: "Successful BuildQ! Build Number ${env.BUILD_NUMBER} , go to ${RENDER_SITE} for more details")
        }
    }
}